# =================================================================
# Spring Boot Configuration for Ecovale HR Backend
# =================================================================

# Application Configuration
spring.application.name=ecovale-hr-backend
server.port=${PORT}
server.address=0.0.0.0
server.shutdown=graceful
spring.lifecycle.timeout-per-shutdown-phase=20s

# =================================================================
# DATABASE CONFIGURATION (Environment Variables)
# =================================================================
# Uses environment variables for security and flexibility
# Set these in your environment or .env file (see .env.example)
spring.datasource.url=jdbc:mysql://${DB_HOST:localhost}:${DB_PORT:3306}/${DB_NAME:ecovale_hr}?useSSL=${DB_USE_SSL:false}&serverTimezone=UTC&allowPublicKeyRetrieval=true&createDatabaseIfNotExist=true
spring.datasource.username=${DB_USERNAME:root}
spring.datasource.password=${DB_PASSWORD:yourpassword}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# Connection Pool Settings (HikariCP - Default in Spring Boot)
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000

# =================================================================
# JPA / HIBERNATE CONFIGURATION
# =================================================================
# DDL Auto: Disabled to allow startup without DB
spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=${JPA_SHOW_SQL:false}
spring.jpa.properties.hibernate.format_sql=${JPA_FORMAT_SQL:false}
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect
spring.jpa.properties.hibernate.jdbc.time_zone=UTC
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
# Allow startup without database
spring.datasource.continue-on-error=true
spring.sql.init.mode=never
spring.jpa.open-in-view=false

# =================================================================
# FLYWAY DATABASE MIGRATION CONFIGURATION
# =================================================================
# Disabled to allow startup without database
spring.flyway.enabled=false

# =================================================================
# LOGGING CONFIGURATION
# =================================================================
logging.level.root=INFO
logging.level.com.ecovale=INFO
logging.level.org.hibernate.SQL=WARN
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=WARN
logging.level.org.springframework=WARN

# =================================================================
# FAST STARTUP CONFIGURATION
# =================================================================
spring.main.lazy-initialization=false
spring.jmx.enabled=false
spring.devtools.restart.enabled=false

# =================================================================
# ACTUATOR ENDPOINTS (Health checks for AWS ELB/ALB)
# =================================================================
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=when-authorized
management.endpoint.health.probes.enabled=true
management.health.livenessState.enabled=true
management.health.readinessState.enabled=true

# =================================================================
# JWT CONFIGURATION (Set in environment variables for production)
# =================================================================
jwt.secret=${JWT_SECRET:default-dev-secret-key-minimum-32-characters-required-for-security}
jwt.expiration=${JWT_EXPIRATION:86400000}
jwt.refresh.expiration=${JWT_REFRESH_EXPIRATION:604800000}

# =================================================================
# CORS CONFIGURATION
# =================================================================
cors.allowed.origins=${CORS_ALLOWED_ORIGINS:http://localhost:3000,http://localhost:5173}
cors.allowed.methods=GET,POST,PUT,DELETE,PATCH,OPTIONS
cors.allowed.headers=*
cors.allow.credentials=true

# =================================================================
# AOP CONFIGURATION (for Audit Logging)
# =================================================================
spring.aop.auto=true
spring.aop.proxy-target-class=true

# =================================================================
# JWT CONFIGURATION
# =================================================================
# IMPORTANT: Change jwt.secret in production to a strong random value (min 32 chars)
jwt.secret=${JWT_SECRET:ecovale-hr-secret-key-change-in-production-minimum-32-characters}
jwt.expiration=${JWT_EXPIRATION:86400000}
# JWT expiration: 86400000 ms = 24 hours
management.endpoint.health.show-details=when-authorized

# =================================================================
# ERROR HANDLING
# =================================================================
server.error.include-message=always
server.error.include-binding-errors=always
server.error.include-stacktrace=on_param
server.error.include-exception=false

# =================================================================
# MULTIPART FILE UPLOAD CONFIGURATION
# =================================================================
spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB

# =================================================================
# TIMEZONE & ENCODING
# =================================================================
spring.jackson.time-zone=UTC
spring.jackson.serialization.write-dates-as-timestamps=false

# =================================================================
# OPENAPI / SWAGGER UI CONFIGURATION
# =================================================================
# SpringDoc OpenAPI Configuration
springdoc.api-docs.path=/v3/api-docs
springdoc.api-docs.enabled=true
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.enabled=${SWAGGER_UI_ENABLED:true}
springdoc.swagger-ui.operationsSorter=method
springdoc.swagger-ui.tagsSorter=alpha
springdoc.swagger-ui.tryItOutEnabled=true
springdoc.swagger-ui.filter=true
springdoc.swagger-ui.syntaxHighlight.activated=true

# Show validation constraints in OpenAPI spec
springdoc.show-actuator=false
springdoc.show-login-endpoint=true
springdoc.override-with-generic-response=false

# Group endpoints by tags
springdoc.group-configs[0].group=v1
springdoc.group-configs[0].paths-to-match=/api/v1/**
springdoc.group-configs[0].packages-to-scan=com.ecovale.hr.controller

# API Information
app.version=1.0.0
