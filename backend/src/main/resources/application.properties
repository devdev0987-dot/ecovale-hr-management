# =================================================================
# Spring Boot Configuration for Ecovale HR Backend
# =================================================================

# Application Configuration
spring.application.name=ecovale-hr-backend

# RAILWAY CRITICAL: Listen on Railway's PORT variable
server.port=${PORT:8080}
# RAILWAY CRITICAL: Bind to all interfaces (not localhost)
server.address=0.0.0.0
# Allow graceful shutdown
server.shutdown=graceful
spring.lifecycle.timeout-per-shutdown-phase=20s

# RAILWAY CRITICAL: Disable hostname validation for healthcheck.railway.app
server.forward-headers-strategy=framework

# CRITICAL: Enable minimal security for Railway (no database required)
railway.minimal-security=true

# CRITICAL: Disable auto-configuration that blocks startup without DB
spring.autoconfigure.exclude=\
  org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration,\
  org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration,\
  org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration

# =================================================================
# DATABASE CONFIGURATION (Environment Variables) - DISABLED FOR RAILWAY
# =================================================================
# Database configuration commented out to prevent auto-configuration
# Uncomment when database is available
#spring.datasource.url=jdbc:mysql://${DB_HOST:localhost}:${DB_PORT:3306}/${DB_NAME:ecovale_hr}?useSSL=${DB_USE_SSL:false}&serverTimezone=UTC&allowPublicKeyRetrieval=true&createDatabaseIfNotExist=true
#spring.datasource.username=${DB_USERNAME:root}
#spring.datasource.password=${DB_PASSWORD:yourpassword}
#spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# Connection Pool Settings (HikariCP) - DISABLED
#spring.datasource.hikari.maximum-pool-size=10
#spring.datasource.hikari.minimum-idle=5
#spring.datasource.hikari.connection-timeout=20000
#spring.datasource.hikari.idle-timeout=300000
#spring.datasource.hikari.max-lifetime=600000
#spring.datasource.hikari.initialization-fail-timeout=-1

# =================================================================
# JPA / HIBERNATE CONFIGURATION - DISABLED FOR RAILWAY
# =================================================================
# CRITICAL: Completely disable JPA to allow startup without database
spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect
spring.jpa.properties.hibernate.jdbc.time_zone=UTC
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.datasource.continue-on-error=true
spring.sql.init.mode=never
spring.jpa.open-in-view=false

# Disable JPA repositories to prevent EntityManager initialization
spring.data.jpa.repositories.enabled=false

# =================================================================
# FLYWAY DATABASE MIGRATION CONFIGURATION
# =================================================================
# Disabled to allow startup without database
spring.flyway.enabled=false

# =================================================================
# LOGGING CONFIGURATION
# =================================================================
logging.level.root=INFO
logging.level.com.ecovale=INFO
logging.level.org.hibernate.SQL=WARN
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=WARN
logging.level.org.springframework=WARN

# =================================================================
# FAST STARTUP CONFIGURATION
# =================================================================
spring.main.lazy-initialization=false
spring.jmx.enabled=false
spring.devtools.restart.enabled=false

# Tomcat fast startup settings
server.tomcat.threads.min-spare=2
server.tomcat.threads.max=50
server.tomcat.connection-timeout=20000
server.tomcat.accept-count=10
server.tomcat.max-connections=200

# =================================================================
# ACTUATOR ENDPOINTS (Health checks for Railway)
# =================================================================
# RAILWAY CRITICAL: Expose health endpoint publicly
management.endpoints.web.exposure.include=health,info,metrics
management.endpoints.web.base-path=/actuator
management.endpoint.health.show-details=always
management.endpoint.health.show-components=always

# Enable probes (Railway compatible)
management.endpoint.health.probes.enabled=true
management.health.livenessState.enabled=true
management.health.readinessState.enabled=true

# RAILWAY CRITICAL: Disable ALL health indicators that require external dependencies
management.health.db.enabled=false
management.health.diskSpace.enabled=true
management.health.ping.enabled=true
management.health.livenessState.enabled=true
management.health.readinessState.enabled=true

# Return UP status immediately
management.endpoint.health.cache.time-to-live=0s
management.health.defaults.enabled=true

# =================================================================
# JWT CONFIGURATION (Set in environment variables for production)
# =================================================================
jwt.secret=${JWT_SECRET:default-dev-secret-key-minimum-32-characters-required-for-security}
jwt.expiration=${JWT_EXPIRATION:86400000}
jwt.refresh.expiration=${JWT_REFRESH_EXPIRATION:604800000}

# =================================================================
# CORS CONFIGURATION
# =================================================================
cors.allowed.origins=${CORS_ALLOWED_ORIGINS:http://localhost:3000,http://localhost:5173}
cors.allowed.methods=GET,POST,PUT,DELETE,PATCH,OPTIONS
cors.allowed.headers=*
cors.allow.credentials=true

# =================================================================
# AOP CONFIGURATION (for Audit Logging)
# =================================================================
spring.aop.auto=true
spring.aop.proxy-target-class=true

# =================================================================
# JWT CONFIGURATION
# =================================================================
# IMPORTANT: Change jwt.secret in production to a strong random value (min 32 chars)
jwt.secret=${JWT_SECRET:ecovale-hr-secret-key-change-in-production-minimum-32-characters}
jwt.expiration=${JWT_EXPIRATION:86400000}
# JWT expiration: 86400000 ms = 24 hours
management.endpoint.health.show-details=when-authorized

# =================================================================
# ERROR HANDLING
# =================================================================
server.error.include-message=always
server.error.include-binding-errors=always
server.error.include-stacktrace=on_param
server.error.include-exception=false

# =================================================================
# MULTIPART FILE UPLOAD CONFIGURATION
# =================================================================
spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB

# =================================================================
# TIMEZONE & ENCODING
# =================================================================
spring.jackson.time-zone=UTC
spring.jackson.serialization.write-dates-as-timestamps=false

# =================================================================
# OPENAPI / SWAGGER UI CONFIGURATION - DISABLED FOR RAILWAY
# =================================================================
# Disabled to prevent Spring Security dependency issues
springdoc.api-docs.enabled=false
springdoc.swagger-ui.enabled=false
